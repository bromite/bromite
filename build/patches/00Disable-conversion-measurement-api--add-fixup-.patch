From: Your Name <you@example.com>
Date: Thu, 5 Jan 2023 11:33:47 +0000
Subject: Disable conversion measurement api (add fixup)

---
 .../attribution_report_network_sender.cc                  | 8 ++++++--
 content/renderer/render_thread_impl.cc                    | 2 +-
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/content/browser/attribution_reporting/attribution_report_network_sender.cc b/content/browser/attribution_reporting/attribution_report_network_sender.cc
--- a/content/browser/attribution_reporting/attribution_report_network_sender.cc
+++ b/content/browser/attribution_reporting/attribution_report_network_sender.cc
@@ -76,6 +76,9 @@ void AttributionReportNetworkSender::SendReport(AttributionDebugReport report) {
 void AttributionReportNetworkSender::SendReport(GURL url,
                                                 base::ValueView report_body,
                                                 UrlLoaderCallback callback) {
+  // this is never called on Bromite but nothing would be sent if it were
+  if ((true)) return;
+
   auto resource_request = std::make_unique<network::ResourceRequest>();
   resource_request->url = std::move(url);
   resource_request->method = net::HttpRequestHeaders::kPostMethod;
@@ -132,8 +135,9 @@ void AttributionReportNetworkSender::SendReport(GURL url,
                    network::SimpleURLLoader::RETRY_ON_NAME_NOT_RESOLVED;
   simple_url_loader_ptr->SetRetryOptions(/*max_retries=*/1, retry_mode);
 
-  // this is never called on Bromite but nothing would be sent if it were
-  OnReportSent(std::move(it), report, is_debug_report, std::move(sent_callback), nullptr);
+  simple_url_loader_ptr->DownloadHeadersOnly(
+      url_loader_factory_.get(),
+      base::BindOnce(std::move(callback), std::move(it)));
 }
 
 void AttributionReportNetworkSender::OnReportSent(
diff --git a/content/renderer/render_thread_impl.cc b/content/renderer/render_thread_impl.cc
--- a/content/renderer/render_thread_impl.cc
+++ b/content/renderer/render_thread_impl.cc
@@ -1823,7 +1823,7 @@ RenderThreadImpl::GetOsSupportForAttributionReporting() {
 
 void RenderThreadImpl::SetOsSupportForAttributionReporting(
     blink::mojom::AttributionOsSupport attribution_os_support) {
-  attribution_os_support_ = attribution_os_support;
+  attribution_os_support_ = blink::mojom::AttributionOsSupport::kDisabled;
 }
 
 }  // namespace content
--
2.25.1
