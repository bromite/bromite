From: csagan5 <32685696+csagan5@users.noreply.github.com>
Date: Wed, 18 Dec 2019 23:54:37 +0100
Subject: Unified consent miscellanous backport fixes

---
 .../privacy/PrivacyPreferences.java           | 26 -------------------
 .../sync/SyncNotificationController.java      | 12 +++------
 2 files changed, 3 insertions(+), 35 deletions(-)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/preferences/privacy/PrivacyPreferences.java b/chrome/android/java/src/org/chromium/chrome/browser/preferences/privacy/PrivacyPreferences.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/preferences/privacy/PrivacyPreferences.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/preferences/privacy/PrivacyPreferences.java
@@ -10,7 +10,6 @@ import android.support.graphics.drawable.VectorDrawableCompat;
 import android.support.v7.preference.CheckBoxPreference;
 import android.support.v7.preference.Preference;
 import android.support.v7.preference.PreferenceFragmentCompat;
-import android.support.v7.preference.PreferenceScreen;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;
@@ -50,13 +49,10 @@ public class PrivacyPreferences
 
     @Override
     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {
-        PrivacyPreferencesManager privacyPrefManager = PrivacyPreferencesManager.getInstance();
-        privacyPrefManager.migrateNetworkPredictionPreferences();
         PreferenceUtils.addPreferencesFromResource(this, R.xml.privacy_preferences);
         getActivity().setTitle(R.string.prefs_privacy);
         setHasOptionsMenu(true);
         PrefServiceBridge prefServiceBridge = PrefServiceBridge.getInstance();
-        PreferenceScreen preferenceScreen = getPreferenceScreen();
 
         mManagedPreferenceDelegate = createManagedPreferenceDelegate();
 
@@ -70,27 +66,6 @@ public class PrivacyPreferences
         networkPredictionPref.setOnPreferenceChangeListener(this);
         networkPredictionPref.setManagedPreferenceDelegate(mManagedPreferenceDelegate);
 
-        if (ChromeFeatureList.isEnabled(ChromeFeatureList.UNIFIED_CONSENT)) {
-            // Remove preferences that were migrated to SyncAndServicesPreferences.
-            preferenceScreen.removePreference(findPreference(PREF_SEARCH_SUGGESTIONS));
-            preferenceScreen.removePreference(findPreference(PREF_CONTEXTUAL_SEARCH));
-
-            // TODO(https://crbug.com/846376): Update strings in XML after UNIFIED_CONSENT launch.
-            networkPredictionPref.setTitle(R.string.preload_pages_title);
-            networkPredictionPref.setSummary(R.string.preload_pages_summary);
-
-            // Put networkPredictionPref after canMakePaymentPref by overriding order value.
-            // However, calling setOrder doesn't change existing order if Preference has already
-            // been added to PreferenceGroup. Remove and re-add it to work around this.
-            // TODO(https://crbug.com/846376): Reorder prefs in XML after UNIFIED_CONSENT launch.
-            preferenceScreen.removePreference(networkPredictionPref);
-            networkPredictionPref.setOrder(canMakePaymentPref.getOrder());
-            preferenceScreen.addPreference(networkPredictionPref);
-
-            updateSummaries();
-            return;
-        }
-
         ChromeBaseCheckBoxPreference searchSuggestionsPref =
                 (ChromeBaseCheckBoxPreference) findPreference(PREF_SEARCH_SUGGESTIONS);
         searchSuggestionsPref.setOnPreferenceChangeListener(this);
@@ -135,7 +110,6 @@ public class PrivacyPreferences
      */
     public void updateSummaries() {
         PrefServiceBridge prefServiceBridge = PrefServiceBridge.getInstance();
-        PrivacyPreferencesManager privacyPrefManager = PrivacyPreferencesManager.getInstance();
 
         CharSequence textOn = getActivity().getResources().getText(R.string.text_on);
         CharSequence textOff = getActivity().getResources().getText(R.string.text_off);
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/sync/SyncNotificationController.java b/chrome/android/java/src/org/chromium/chrome/browser/sync/SyncNotificationController.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/sync/SyncNotificationController.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/sync/SyncNotificationController.java
@@ -157,15 +157,9 @@ public class SyncNotificationController implements ProfileSyncService.SyncStateC
      * @return the intent for opening the settings
      */
     private Intent createSettingsIntent() {
-        final String fragmentName;
-        final Bundle fragmentArguments;
-        if (ChromeFeatureList.isEnabled(ChromeFeatureList.UNIFIED_CONSENT)) {
-            fragmentName = SyncAndServicesPreferences.class.getName();
-            fragmentArguments = SyncAndServicesPreferences.createArguments(false);
-        } else {
-            fragmentName = AccountManagementFragment.class.getName();
-            fragmentArguments = null;
-        }
+        final String fragmentName = AccountManagementFragment.class.getName();
+        final Bundle fragmentArguments = null;
+
         return PreferencesLauncher.createIntentForSettingsPage(
                 ContextUtils.getApplicationContext(), fragmentName, fragmentArguments);
     }
-- 
2.17.1

