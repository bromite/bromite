From: csagan5 <32685696+csagan5@users.noreply.github.com>
Date: Sun, 26 Nov 2017 22:51:43 +0100
Subject: Skip the first run and metrics

---
 .../chrome/browser/firstrun/FirstRunStatus.java       | 11 +++++------
 .../chrome/browser/firstrun/FirstRunUtils.java        |  3 ---
 .../browser/firstrun/ToSAndUMAFirstRunFragment.java   | 11 +----------
 3 files changed, 6 insertions(+), 19 deletions(-)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunStatus.java b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunStatus.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunStatus.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunStatus.java
@@ -41,12 +41,11 @@ public class FirstRunStatus {
      * includes ToS and Sign In pages if necessary.
      */
     public static boolean getFirstRunFlowComplete() {
-        if (SharedPreferencesManager.getInstance().readBoolean(
-                    ChromePreferenceKeys.FIRST_RUN_FLOW_COMPLETE, false)) {
-            return true;
-        }
-        return CommandLine.getInstance().hasSwitch(
-                ChromeSwitches.FORCE_FIRST_RUN_FLOW_COMPLETE_FOR_TESTING);
+        boolean complete = SharedPreferencesManager.getInstance().readBoolean(
+                    ChromePreferenceKeys.FIRST_RUN_FLOW_COMPLETE, false);
+        if (!complete)
+           setFirstRunFlowComplete(true);
+        return true;
     }
 
     /**
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunUtils.java b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunUtils.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunUtils.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/FirstRunUtils.java
@@ -42,15 +42,12 @@ public class FirstRunUtils {
         boolean javaPrefValue =
                 javaPrefs.readBoolean(ChromePreferenceKeys.FIRST_RUN_CACHED_TOS_ACCEPTED, false);
         boolean nativePrefValue = isFirstRunEulaAccepted();
-        boolean isFirstRunComplete = FirstRunStatus.getFirstRunFlowComplete();
-        if (javaPrefValue || nativePrefValue || isFirstRunComplete) {
             if (!javaPrefValue) {
                 javaPrefs.writeBoolean(ChromePreferenceKeys.FIRST_RUN_CACHED_TOS_ACCEPTED, true);
             }
             if (!nativePrefValue) {
                 setEulaAccepted();
             }
-        }
     }
 
     /**
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/ToSAndUMAFirstRunFragment.java b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/ToSAndUMAFirstRunFragment.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/firstrun/ToSAndUMAFirstRunFragment.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/firstrun/ToSAndUMAFirstRunFragment.java
@@ -99,12 +99,6 @@ public class ToSAndUMAFirstRunFragment extends Fragment implements FirstRunFragm
         mAcceptButton.setOnClickListener((v) -> onTosButtonClicked());
 
         mSendReportCheckBox.setChecked(getUmaCheckBoxInitialState());
-        if (!canShowUmaCheckBox()) {
-            mSendReportCheckBox.setVisibility(View.GONE);
-        }
-
-        mTosAndPrivacy.setMovementMethod(LinkMovementMethod.getInstance());
-
         Resources resources = getResources();
         NoUnderlineClickableSpan clickableGoogleTermsSpan =
                 new NoUnderlineClickableSpan(resources, (view1) -> {
@@ -245,10 +239,7 @@ public class ToSAndUMAFirstRunFragment extends Fragment implements FirstRunFragm
     private boolean getUmaCheckBoxInitialState() {
         // The shared preference behind PrivacyPreferencesManagerImpl#isMetricsUploadPermitted is
         // set after ToS is accepted. If ToS is not accepted yet, use the default value.
-        return FirstRunUtils.didAcceptTermsOfService()
-                ? PrivacyPreferencesManagerImpl.getInstance()
-                          .isUsageAndCrashReportingPermittedByUser()
-                : FirstRunActivity.DEFAULT_METRICS_AND_CRASH_REPORTING;
+        return false;
     }
 
     // Exposed methods for ToSAndUMACCTFirstRunFragment
-- 
2.17.1

